<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abstract Atelier</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' }
  </script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Mono:wght@500;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="32x32" href="icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
  <!-- Quill CSS -->
  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">

</head>
<body class="antialiased bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 min-h-screen selection:bg-blue-200 dark:selection:bg-blue-900">

  <!-- Top bar: Title + Theme toggle + Quill toolbar (centered) -->
  <div id="topbar" class="fixed top-0 inset-x-0 z-50 border-b">
    <div class="max-w-7xl mx-auto px-4">
      <div class="py-3 flex items-center justify-center">
        <div id="title-row" class="relative inline-flex items-baseline justify-center gap-2 text-center">
          <span id="title-author-ghost" aria-hidden="true" class="invisible pointer-events-none select-none whitespace-nowrap text-sm font-normal italic text-stone-500 dark:text-stone-300">by Mohammad Almeqdadi, MD</span>
          <h1 class="header-title text-xl font-bold text-stone-700 dark:text-stone-100 whitespace-nowrap">Abstract Atelier</h1>
          <span id="title-author" class="text-sm font-normal italic text-stone-500 dark:text-stone-300 whitespace-nowrap" data-author-full="by Mohammad Almeqdadi, MD" data-author-short="by M Almeqdadi, MD" data-author-tiny="by M Almeqdadi">by Mohammad Almeqdadi, MD</span>
        </div>
      </div>
    </div>
    <!-- Important: Use a dedicated toolbar container with a stable id. Do NOT pre-apply .ql-toolbar -->
    <div id="toolbar">
      <span class="ql-formats">
        <button id="theme-toggle" type="button" aria-label="Toggle theme" class="ql-custom-btn ql-theme-btn"></button>
        <button id="view-toggle" type="button" aria-label="Enable view-only mode" class="ql-custom-btn ql-view-btn">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
        <button id="toggle-sidebar" type="button" aria-label="Hide citations panel" aria-controls="pmid-sidebar" aria-expanded="true" class="ql-custom-btn">
          <svg id="sidebar-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transition-transform duration-200" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
            <path d="M7 4h7l3 3v13H7z" stroke-linejoin="round"></path>
            <path d="M14 4v3h3" stroke-linejoin="round"></path>
            <path d="M9 11h6M9 14h6M9 17h6" stroke-linecap="round"></path>
          </svg>
        </button>
        <button id="copy-html" type="button" aria-label="Copy as HTML" class="ql-custom-btn">
          <svg id="copy-icon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-transform duration-200" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 1H4a2 2 0 0 0-2 2v14h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm-1 16H8V7h11v14z"/>
          </svg>
        </button>
        <button id="export-pdf" type="button" aria-label="Export to PDF" class="ql-custom-btn">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
          </svg>
        </button>
      </span>
      <div class="toolbar-formatting">
        <span class="ql-formats">
          <button class="ql-bold"></button>
          <button class="ql-italic"></button>
          <button class="ql-underline"></button>
        </span>
        <span class="ql-formats">
          <button class="ql-align" value=""></button>
          <button class="ql-align" value="center"></button>
          <button class="ql-align" value="justify"></button>
        </span>
        <span class="ql-formats">
          <button class="ql-list" value="ordered"></button>
          <button class="ql-list" value="bullet"></button>
        </span>
        <span class="ql-formats">
          <button class="ql-clean"></button>
        </span>
        <span class="toolbar-readonly-banner" aria-hidden="true">READ ONLY</span>
      </div>
    </div>
  </div>

  <!-- Main -->
  <main class="w-full pt-28 pb-12 overflow-visible">
    <div id="workspace-shell" class="flex flex-col md:flex-row md:items-start gap-6">
      <aside id="pmid-sidebar" class="nice-scroll" aria-label="PMID citations panel">
        <div class="pmid-sidebar-header">
          <span class="pmid-sidebar-title">
            <span class="pmid-sidebar-title-label">CITATIONS</span>
            <span id="pmid-sidebar-count" class="pmid-sidebar-count" aria-live="polite">0</span>
          </span>
        </div>
        <div id="pmid-card-list"></div>
        <div id="pmid-sidebar-empty" class="pmid-empty-state">Add a PMID citation in your text to see it here.</div>
      </aside>
      <div class="flex-1 min-w-0 flex justify-center">
        <div id="editor-card">
          <div id="editor-shell">
            <div id="editor"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Floating status pill -->
  <div id="statusbar" class="text-sm text-gray-700 dark:text-gray-300" role="status" aria-live="polite">
    <span class="stat" id="s-words" data-label="Words" aria-label="Words 0">
      <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" class="h-4 w-4">
        <path d="M4 5h12M4 10h9M4 15h8" stroke-linecap="round"/>
      </svg>
      <span class="stat-label" aria-hidden="true">Words</span>
      <span class="stat-text">0</span>
    </span>
    <span class="separator">•</span>
    <span class="stat" id="s-chars" data-label="Chars" aria-label="Chars 0">
      <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" class="h-4 w-4">
        <path d="M5 15L10 5l5 10M7 13h6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="stat-label" aria-hidden="true">Chars</span>
      <span class="stat-text">0</span>
    </span>
    <span class="separator">•</span>
    <span class="stat" id="s-pmids" data-label="PMIDs" aria-label="PMIDs 0">
      <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.6" class="h-4 w-4">
        <path d="M6 4h6l3 3v9H6z" stroke-linejoin="round"/>
        <path d="M12 4v3h3" stroke-linejoin="round"/>
        <path d="M8 9h5M8 12h5M8 15h5" stroke-linecap="round"/>
      </svg>
      <span class="stat-label" aria-hidden="true">PMIDs</span>
      <span class="stat-text">0</span>
    </span>
  </div>

  <!-- Popup -->
  <div id="popup" class="p-4 shadow-2xl"></div>

  <!-- Quill JS -->
  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
  <script src="app.js"></script>
</body>
</html>
